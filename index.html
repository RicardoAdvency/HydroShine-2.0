<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculadora Solar | EPC & Comisión</title>

  <style>
    :root{
      --bg:#070a0f;
      --bg2:#0b1020;
      --panel:#0c1222;
      --panel2:#0a0f1c;
      --line:rgba(255,255,255,.10);
      --line2:rgba(255,255,255,.06);
      --text:#eef3fb;
      --muted:rgba(238,243,251,.70);
      --muted2:rgba(238,243,251,.50);
      --gold:#f5a400;      /* home power vibe */
      --teal:#7bb8bd;      /* lightreach vibe */
      --good:#36d399;
      --bad:#ff5a6a;
      --shadow: 0 18px 50px rgba(0,0,0,.55);
      --shadow2: 0 10px 30px rgba(0,0,0,.45);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 600px at 15% 10%, rgba(123,184,189,.14), transparent 60%),
        radial-gradient(900px 700px at 85% 0%, rgba(245,164,0,.10), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      letter-spacing:.2px;
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 28px 18px 40px;
    }

    /* Header */
    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding:18px 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--line2);
      box-shadow: var(--shadow2);
    }
    .logos{
      display:flex;
      align-items:center;
      gap:18px;
      min-width: 280px;
    }
    .logos img{
      height:44px;
      width:auto;
      object-fit:contain;
      filter: drop-shadow(0 6px 18px rgba(0,0,0,.45));
    }
    .brand{
      text-align:right;
      line-height:1.1;
    }
    .brand .title{
      font-size:14px;
      text-transform:uppercase;
      letter-spacing:2.4px;
      color:var(--muted);
    }
    .brand .sub{
      margin-top:6px;
      font-size:12px;
      color:var(--muted2);
    }

    /* Main card */
    .card{
      margin-top:18px;
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line2);
      box-shadow: var(--shadow);
      padding:18px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr .6fr;
      gap:12px;
    }

    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:1.8px;
      margin-bottom:8px;
    }

    .input{
      width:100%;
      padding:13px 12px;
      background: rgba(0,0,0,.18);
      color:var(--text);
      border:1px solid var(--line);
      outline:none;
      font-size:14px;
    }
    .input:focus{
      border-color: rgba(245,164,0,.55);
      box-shadow: 0 0 0 4px rgba(245,164,0,.10);
    }

    .row2{
      margin-top:12px;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:flex-end;
    }

    .btn{
      padding:13px 14px;
      background: linear-gradient(90deg, rgba(245,164,0,.95), rgba(123,184,189,.85));
      color:#081018;
      border:1px solid rgba(255,255,255,.12);
      font-weight:700;
      letter-spacing:.6px;
      cursor:pointer;
      text-transform:uppercase;
      font-size:12px;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.secondary{
      background: transparent;
      color: var(--text);
      border:1px solid var(--line);
    }

    .hint{
      margin-top:10px;
      font-size:12px;
      color:var(--muted2);
      line-height:1.5;
    }

    /* Results */
    .results{
      margin-top:16px;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:10px;
    }
    .tile{
      background: rgba(0,0,0,.18);
      border:1px solid var(--line2);
      padding:12px;
      min-height:86px;
    }
    .tile .k{
      font-size:11px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:1.7px;
      margin-bottom:8px;
    }
    .tile .v{
      font-size:18px;
      font-weight:800;
      letter-spacing:.3px;
    }
    .tile .v small{
      font-size:12px;
      color:var(--muted2);
      font-weight:600;
    }

    .bar{
      margin-top:12px;
      padding:12px;
      border:1px solid var(--line2);
      background: rgba(0,0,0,.16);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .status{
      display:flex;
      align-items:center;
      gap:10px;
      font-size:13px;
      color:var(--muted);
    }
    .dot{
      width:10px; height:10px;
      border-radius:0; /* no redondo */
      background: var(--good);
      box-shadow: 0 0 0 4px rgba(54,211,153,.12);
    }
    .dot.bad{
      background: var(--bad);
      box-shadow: 0 0 0 4px rgba(255,90,106,.12);
    }

    .money{
      font-size:14px;
      color:var(--muted2);
    }

    .footer{
      margin-top:12px;
      padding-top:12px;
      border-top:1px solid var(--line2);
      display:flex;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      font-size:11px;
      color:var(--muted2);
      line-height:1.5;
    }

    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
      .results{ grid-template-columns: repeat(2, 1fr); }
      .brand{ text-align:left; }
      .top{ flex-direction:column; align-items:flex-start; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="logos">
        <!-- Cambia estos src por tus rutas en GitHub/Netlify -->
        <img src="homepower-logo.png" alt="Home Power" />
        <img src="lightreach-logo.png" alt="LightReach" />
      </div>

      <div class="brand">
        <div class="title">Solar EPC & Commission</div>
        <div class="sub">Watts (410W) × EPC → Precio · Precio × % → Comisión</div>
      </div>
    </div>

    <div class="card">
      <div class="grid">
        <div>
          <label>Tabla EPC (Batería)</label>
          <select id="tableSelect" class="input">
            <option value="TESLA_1PW3">Tesla · 1 PW3 Hybrid</option>
            <option value="TESLA_2PW3">Tesla · 2 Baterías (PW3)</option>
            <option value="ENPHASE_2x5P">Enphase · 2 - 5P DOM</option>
            <option value="ENPHASE_3x5P">Enphase · 3 - 5P DOM</option>
            <option value="ENPHASE_4x5P">Enphase · 4 - 5P DOM</option>
          </select>
        </div>

        <div>
          <label># Paneles</label>
          <input id="panels" class="input" type="number" min="1" step="1" value="10" />
        </div>

        <div>
          <label>% Contrato</label>
          <select id="pct" class="input">
            <option value="6">6%</option>
            <option value="12">12%</option>
            <option value="13">13%</option>
            <option value="14">14%</option>
            <option value="15">15%</option>
          </select>
        </div>
      </div>

      <div class="row2">
        <button class="btn" id="calcBtn">Calcular</button>
        <button class="btn secondary" id="resetBtn">Reset</button>
        <div class="hint">
          * Cálculo: <strong>Watts = 410 × Paneles</strong> · <strong>Precio = Watts × EPC</strong> · <strong>Comisión = Precio × %</strong>
        </div>
      </div>

      <div class="results">
        <div class="tile">
          <div class="k">Watts Totales</div>
          <div class="v" id="outWatts">—</div>
        </div>
        <div class="tile">
          <div class="k">kW (referencia)</div>
          <div class="v" id="outKW">—</div>
        </div>
        <div class="tile">
          <div class="k">EPC</div>
          <div class="v" id="outEPC">—</div>
        </div>
        <div class="tile">
          <div class="k">Precio</div>
          <div class="v" id="outPrice">—</div>
        </div>
      </div>

      <div class="bar">
        <div class="status">
          <span class="dot" id="dot"></span>
          <span id="statusText">Listo.</span>
        </div>
        <div class="money">
          Comisión: <strong id="outCommission">—</strong>
        </div>
      </div>

      <div class="footer">
        <div>
          EPC depende de la tabla seleccionada. Si el # de paneles no existe, te avisará.
        </div>
        <div>
          Consejo: si quieres permitir % custom (ej. 8.5%), se cambia a input en 10 segundos.
        </div>
      </div>
    </div>
  </div>

  <script>
    // =========================
    // CONFIG
    // =========================
    const WATTS_PER_PANEL = 410;

    // EPC TABLES (paneles -> EPC)
    // IMPORTANTE: Esto está listo para que pegues la tabla completa.
    // Si me mandas la tabla en texto (o sheet), te lo dejo 100% completo sin faltar filas.
    const EPC_TABLES = {
      // Tesla 1 PW3 Hybrid (según screenshot: 10–33)
      TESLA_1PW3: {
        10: 5.15,
        11: 5.15,
        12: 4.94,
        13: 4.75,
        14: 4.58,
        15: 4.43,
        16: 4.31,
        17: 4.19,
        18: 4.09,
        19: 4.00,
        20: 3.92,
        21: 3.85,
        22: 3.79,
        23: 3.73,
        24: 3.67,
        25: 3.62,
        26: 3.57,
        27: 3.53,
        28: 3.49,
        29: 3.45,
        30: 3.42,
        31: 3.38,
        32: 3.35,
        33: 3.32
      },

      // Tesla 2 Baterías (PGE 2 Tesla screenshot: 22–66)
      TESLA_2PW3: {
        22: 5.01,
        23: 4.89,
        24: 4.79,
        25: 4.69,
        26: 4.60,
        27: 4.52,
        28: 4.45,
        29: 4.38,
        30: 4.31,
        31: 4.25,
        32: 4.19,
        33: 4.14,
        34: 4.09,
        35: 4.04,
        36: 3.99,
        37: 3.95,
        38: 3.91,
        39: 3.87,
        40: 3.83,
        41: 3.80,
        42: 3.76,
        43: 3.73,
        44: 3.70,
        45: 3.67,
        46: 3.65,
        47: 3.62,
        48: 3.59,
        49: 3.57,
        50: 3.55,
        51: 3.52,
        52: 3.50,
        53: 3.48,
        54: 3.46,
        55: 3.44,
        56: 3.42,
        57: 3.41,
        58: 3.39,
        59: 3.37,
        60: 3.36,
        61: 3.34,
        62: 3.32,
        63: 3.31,
        64: 3.30,
        65: 3.28,
        66: 3.27
      },

      // Enphase 2 - 5P DOM (según screenshot: 10–15)
      ENPHASE_2x5P: {
        10: 4.96,
        11: 4.84,
        12: 4.64,
        13: 4.46,
        14: 4.32,
        15: 4.19
      },

      // Enphase 3 - 5P DOM (según screenshot larga: 13–40)
      ENPHASE_3x5P: {
        13: 4.75,
        14: 4.56,
        15: 4.43,
        16: 4.31,
        17: 4.19,
        18: 4.09,
        19: 4.00,
        20: 3.92,
        21: 3.85,
        22: 3.79,
        23: 3.73,
        24: 3.67,
        25: 3.62,
        26: 3.57,
        27: 3.53,
        28: 3.49,
        29: 3.45,
        30: 3.42,
        31: 3.38,
        32: 3.35,
        33: 3.32,
        34: 3.30,
        35: 3.27,
        36: 3.25,
        37: 3.22,
        38: 3.20,
        39: 3.18,
        40: 3.16
      },

      // Enphase 4 - 5P DOM (según screenshot: 22–64)
      ENPHASE_4x5P: {
        22: 4.28,
        23: 4.20,
        24: 4.13,
        25: 4.06,
        26: 3.99,
        27: 3.94,
        28: 3.88,
        29: 3.83,
        30: 3.78,
        31: 3.74,
        32: 3.70,
        33: 3.66,
        34: 3.62,
        35: 3.58,
        36: 3.55,
        37: 3.52,
        38: 3.49,
        39: 3.46,
        40: 3.44,
        41: 3.41,
        42: 3.39,
        43: 3.36,
        44: 3.34,
        45: 3.32,
        46: 3.30,
        47: 3.28,
        48: 3.26,
        49: 3.25,
        50: 3.23,
        51: 3.21,
        52: 3.20,
        53: 3.18,
        54: 3.17,
        55: 3.15,
        56: 3.14,
        57: 3.13,
        58: 3.11,
        59: 3.10,
        60: 3.09,
        61: 3.08,
        62: 3.07,
        63: 3.06,
        64: 3.05
      }
    };

    // =========================
    // Helpers
    // =========================
    const $ = (id) => document.getElementById(id);

    const money = (n) => {
      if (!isFinite(n)) return "—";
      return new Intl.NumberFormat("en-US", { style:"currency", currency:"USD", maximumFractionDigits:2 }).format(n);
    };

    const num = (n, d=2) => {
      if (!isFinite(n)) return "—";
      return new Intl.NumberFormat("en-US", { maximumFractionDigits:d }).format(n);
    };

    function setStatus(ok, msg){
      const dot = $("dot");
      dot.classList.toggle("bad", !ok);
      $("statusText").textContent = msg;
    }

    function getEPC(tableKey, panels){
      const table = EPC_TABLES[tableKey] || {};
      return table[panels]; // undefined si no existe
    }

    // =========================
    // Core calc
    // =========================
    function calculate(){
      const tableKey = $("tableSelect").value;
      const panels = parseInt($("panels").value || "0", 10);
      const pct = parseFloat($("pct").value || "0");

      if (!panels || panels <= 0){
        setStatus(false, "Pon una cantidad válida de paneles.");
        return clearOutputs();
      }

      const epc = getEPC(tableKey, panels);

      const watts = WATTS_PER_PANEL * panels;
      const kw = watts / 1000;

      $("outWatts").textContent = num(watts, 0);
      $("outKW").textContent = num(kw, 2);

      if (!epc){
        $("outEPC").textContent = "—";
        $("outPrice").textContent = "—";
        $("outCommission").textContent = "—";
        setStatus(false, `Ese # de paneles (${panels}) no existe en la tabla seleccionada.`);
        return;
      }

      const price = watts * epc;
      const commission = price * (pct / 100);

      $("outEPC").textContent = `$${num(epc, 2)} / W`;
      $("outPrice").textContent = money(price);
      $("outCommission").textContent = money(commission);

      setStatus(true, "Cálculo listo.");
    }

    function clearOutputs(){
      $("outWatts").textContent = "—";
      $("outKW").textContent = "—";
      $("outEPC").textContent = "—";
      $("outPrice").textContent = "—";
      $("outCommission").textContent = "—";
    }

    function resetAll(){
      $("tableSelect").value = "TESLA_1PW3";
      $("panels").value = 10;
      $("pct").value = 6;
      clearOutputs();
      setStatus(true, "Listo.");
      calculate();
    }

    // =========================
    // Events
    // =========================
    $("calcBtn").addEventListener("click", calculate);
    $("resetBtn").addEventListener("click", resetAll);

    ["tableSelect","panels","pct"].forEach(id=>{
      $(id).addEventListener("input", calculate);
      $(id).addEventListener("change", calculate);
    });

    // init
    calculate();
  </script>
</body>
</html>
